<html>

<head>
  <title>Kanji Tree</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <meta charset="UTF-8">
  <script src="data.js"></script>
  <script src="jlpt3.js"></script>
  <script src="jlpt2.js"></script>
  <script src="jlpt4.js"></script>
  <script src="jlpt1.js"></script>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div id="nonjoyou"></div>
  <script>
    function buildNonjoyou(source) {
      const request = new XMLHttpRequest();
      request.open('GET', 'kanji-list-my-nonjoyou.txt', true);
      request.onload = function () {
        if (request.responseText) {
          request.responseText.split('\n').forEach(o => document.body.insertAdjacentHTML('beforeend', `<div class="nonjoyou">${o}</div>`))
        }
      };
      request.send();
    }
    function buildTree(myKanjiSource) {
      const my = JSON.stringify(myKanjiSource.split('\n'));
      const levels = {
        jlpt3 : JSON.parse(localStorage.getItem('jlpt3')),
        jlpt2 : JSON.parse(localStorage.getItem('jlpt2')),
        jlpt4 : JSON.parse(localStorage.getItem('jlpt4')),
        jlpt1 : JSON.parse(localStorage.getItem('jlpt1'))
      }
      JSON.parse(localStorage.getItem('joyouKanjiAll')).forEach(k => {
        let classes = [];
        classes.push('level' + k.l);
        let title = 'level' + k.l;
        let currentLevel = '';
        Object.keys(levels).forEach(level => {
          if (levels[level].includes(k.k)) {
            currentLevel = level
            classes.push(currentLevel);
            title += ' ' + currentLevel
          }
        })
        if (my.includes(k.k)) {
          classes.push('joyou_known')
        } else {
          classes.push('focus' + currentLevel.substr(-1));
        }
        document.body.insertAdjacentHTML('beforeend', `
            <div class="joyou ${classes.join(' ')}" title="${title}">${k.k}</div>
          `)
      })

    }
    const myKanjiSource = null;
    const request = new XMLHttpRequest();
    request.open('GET', 'kanji-list-my-known.txt', true);
    request.onload = function () {
      if (request.responseText) {
        buildTree(request.responseText)
      }
    };
    request.send();
    buildNonjoyou();
  </script>
</body>

</html>
